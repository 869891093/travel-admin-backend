# 跟团游小程序后台管理系统

这是一个基于Web的管理后台，用于管理跟团游小程序的产品、区域、轮播图和订单数据。

## 功能特性

### ✅ 已实现功能
- **仪表盘**: 数据统计和图表展示
- **产品管理**: 完整的CRUD操作（创建、读取、更新、删除）
- **区域管理**: 区域信息管理
- **轮播图管理**: 首页轮播图管理
- **订单管理**: 订单查看和状态管理
- **系统设置**: 云开发环境配置
- **响应式设计**: 支持移动端和桌面端
- **本地存储**: 离线模式支持

### 🔧 技术栈
- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **图表**: Chart.js
- **图标**: Font Awesome
- **后端**: Node.js + Express
- **云服务**: 微信云开发
- **代理**: 本地代理服务器解决CORS问题

## 快速开始

### 1. 环境要求
- Node.js 14+ 
- npm 6+

### 2. 安装依赖
```bash
cd miniprogram-5/admin
npm install
```

### 3. 启动系统
```bash
# 方法1: 使用启动脚本（推荐）
./start.sh

# 方法2: 直接启动
npm start
```

### 4. 访问管理界面
打开浏览器访问: http://localhost:3000

## 系统配置

### 云开发环境配置
1. 在系统设置页面配置您的云开发环境ID
2. 配置API密钥（可选，用于直接调用微信API）

### 环境变量
- `envId`: 微信云开发环境ID
- `apiKey`: 微信API密钥（可选）

## 功能说明

### 仪表盘
- 显示产品、区域、订单、用户的统计数据
- 展示订单趋势图表
- 展示产品分布图表

### 产品管理
- **添加产品**: 填写产品信息，包括名称、描述、价格、区域等
- **编辑产品**: 修改现有产品信息
- **删除产品**: 删除不需要的产品
- **状态管理**: 启用/禁用产品

### 区域管理
- **添加区域**: 创建新的旅游区域
- **编辑区域**: 修改区域信息
- **删除区域**: 删除区域
- **热门设置**: 设置热门区域
- **排序管理**: 调整区域显示顺序

### 轮播图管理
- **添加轮播图**: 上传首页轮播图
- **编辑轮播图**: 修改轮播图信息
- **删除轮播图**: 删除轮播图
- **排序管理**: 调整轮播图显示顺序

### 订单管理
- **查看订单**: 查看订单详细信息
- **状态筛选**: 按订单状态筛选
- **订单详情**: 查看订单的完整信息

## API接口

### 云函数接口
系统通过以下云函数与微信云开发交互：

- `httpAPI`: 通用数据操作接口
- `getAccessToken`: 获取访问令牌

### 本地代理
为了解决CORS问题，系统使用本地代理服务器：

- 代理地址: http://localhost:3000/api/cloud-function
- 健康检查: http://localhost:3000/api/health
- 测试接口: http://localhost:3000/api/test

## 数据存储

### 云端存储
- 产品数据: `products` 集合
- 区域数据: `regions` 集合
- 轮播图数据: `banners` 集合
- 订单数据: `orders` 集合

### 本地存储
当云端连接失败时，系统会自动切换到本地存储模式：
- 使用浏览器localStorage存储数据
- 提供完整的离线功能

## 故障排除

### 常见问题

1. **无法连接云函数**
   - 检查云开发环境ID是否正确
   - 确认云函数已部署
   - 检查网络连接

2. **CORS错误**
   - 确保代理服务器正在运行
   - 检查端口3000是否被占用

3. **数据不显示**
   - 检查浏览器控制台错误信息
   - 确认数据格式正确
   - 尝试刷新页面

### 调试模式
打开浏览器开发者工具，查看控制台日志：
- API调用日志
- 错误信息
- 数据加载状态

## 开发指南

### 添加新功能
1. 在HTML中添加界面元素
2. 在CSS中添加样式
3. 在JavaScript中添加逻辑
4. 在云函数中添加API接口

### 自定义样式
修改 `css/style.css` 文件来自定义界面样式。

### 扩展API
在 `js/api.js` 中添加新的API方法。

## 部署说明

### 本地部署
1. 克隆项目到本地
2. 安装依赖: `npm install`
3. 启动服务器: `npm start`
4. 访问 http://localhost:3000

### 生产部署
1. 配置生产环境的环境变量
2. 使用PM2等进程管理器
3. 配置反向代理（如Nginx）
4. 设置HTTPS证书

## 更新日志

### v1.0.0 (2024-01-XX)
- ✅ 完成基础CRUD功能
- ✅ 实现云函数连接
- ✅ 添加本地存储备用方案
- ✅ 完善用户界面
- ✅ 添加响应式设计

## 许可证

MIT License

## 联系方式

如有问题或建议，请联系开发团队。 